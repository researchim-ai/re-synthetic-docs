Thought for a couple of seconds


```markdown
# SyntheticDocs

**Набор инструментов для генерации синтетических «отсканированных» A4-документов с подписями, печатями и артефактами сканирования для обучения VLM/LLM.**

> ❗️ **Только для исследовательских целей:** этот проект предназначен исключительно для научных исследований и экспериментов. Сгенерированные документы **не должны** использоваться в реальных или производственных сценариях и ни в коем случае не применяться в мошеннических целях.

---

## Особенности

- **Генерация текста LLM-моделью** через [vLLM](https://github.com/vllm-project/vllm) + модели Hugging Face  
- **Шаблонные промпты** из `prompts.json` для разных типов документов  
- **Поддержка кириллического шрифта** для реалистичного русского текста  
- **Наложение подписей и печатей** с автоматическим масштабированием и сохранением прозрачности  
- **Эффекты «сканирования»** (перспектива, размытие, JPEG-артефакты, шум) через Albumentations  
- **Вывод**:  
  - PDF-файл (`.pdf`)  
  - Высокое разрешение PNG (`.png`, 300 DPI)  
  - JSON с метаданными (`.json`): bounding-box’ы, реальный текст из LLM  

---

## Структура проекта

```

re-synthetic-docs/
├── assets/
│   ├── signatures/
│   │   ├── fonts/         # .ttf-шрифты для генерации подписей
│   │   └── png/           # готовые PNG-подписи
│   └── stamps/
│       ├── fonts/         # .ttf-шрифты для генерации печатей
│       └── png/           # готовые PNG-печати
├── prompts.json          # JSON-шаблоны промптов по типам документов
├── make\_signatures.py    # скрипт генерации подписей из шрифтов
├── make\_stamps.py        # скрипт генерации круглых печатей
├── syntheticdocs.py      # основной генератор: LLM → PDF → PNG → метаданные
└── requirements.txt      # зависимости Python

````

---

## Быстрый старт

### 1. Клонирование и установка

```bash
git clone https://github.com/your-org/re-synthetic-docs.git
cd re-synthetic-docs

# (рекомендуется) создайте и активируйте виртуальное окружение
python3 -m venv venv
source venv/bin/activate

pip install --upgrade pip
pip install -r requirements.txt
````

> **Примечание:**
>
> * Требуется Python 3.10+.
> * Для GPU-ускорения установите совместимый `torch` + CUDA **до** установки `vllm`.
> * На Linux может потребоваться `poppler-utils` для `pdftoppm`:
>
>   ```bash
>   sudo apt update && sudo apt install -y poppler-utils
>   ```

### 2. Подготовка активов

1. **Шрифты**
   Положите хотя бы один кириллический `.ttf` в `assets/signatures/fonts/` и `assets/stamps/fonts/`.

2. **Генерация подписей (опционально)**

   ```bash
   python make_signatures.py
   ```

   — \~500 PNG-подписей появятся в `assets/signatures/png/`.

3. **Генерация печатей (опционально)**

   ```bash
   python make_stamps.py
   ```

   — \~30 PNG-печати появятся в `assets/stamps/png/`.

### 3. Настройка шаблонов

Откройте `prompts.json` и при необходимости отредактируйте шаблоны промптов для каждого типа документа. В шаблонах используются плейсхолдеры `{field}`.

### 4. Запуск генератора

```bash
python syntheticdocs.py \
  --model   "/путь/к/вашей/модели/или_repo-id" \
  --font    assets/signatures/fonts/YourCyrillicFont.ttf \
  --signatures assets/signatures/png \
  --stamps  assets/stamps/png \
  --out     out \
  -n        10
```

* `--model` — репозиторий HF (например, `mistralai/Mistral-7B-Instruct-v0.2`) или локальная папка модели
* `--font` — путь к кириллическому `.ttf` для текста в PDF
* `--signatures`, `--stamps` — папки с PNG-оверлеями (α-канал)
* `--out` — выходная директория (создаётся автоматически)
* `-n` — количество документов для генерации

**После выполнения** вы получите в папке `out/`:

```
out/
├── <uuid1>.pdf
├── <uuid1>.png
├── <uuid1>.json
├── <uuid2>.pdf
├── <uuid2>.png
├── <uuid2>.json
└── …
```

* `<uuid>.pdf` — PDF документа
* `<uuid>.png` — «отсканированное» изображение (300 DPI)
* `<uuid>.json`:

  ```jsonc
  {
    "id": "<uuid>",
    "type": "<doc_type>",
    "text": "<реальный текст из LLM>",
    "bboxes": [
      { "type": "signature", "coords": [x0, y0, x1, y1] },
      { "type": "stamp",     "coords": [x0, y0, x1, y1] }
    ]
  }
  ```

---

## Настройка и расширение

* **Новые типы документов**: добавьте ключ и шаблон в `prompts.json`.
* **Эффекты сканирования**: измените pipeline `aug = A.Compose([...])` в `syntheticdocs.py`.
* **Многополосные документы**: доработайте функцию `draw_pdf()`.
* **Параллельная генерация**: используйте `asyncio` или батчи в vLLM для ускорения.

---

## Лицензия и отказ от ответственности

Этот код предоставляется «как есть» и предназначен **исключительно** для исследовательских целей.
Авторы не несут ответственности за любое неправомерное использование.

---

```
```
